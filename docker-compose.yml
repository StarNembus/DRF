version: '3.1'

services:
      db:
        image: postgres:13.5
        privileged: true
        restart: always
        ports:
          - 54325:5432
        environment:
          POSTGRES_USER: kwazart
          POSTGRES_PASSWORD: 52669
          POSTGRES_DB: DRF
      backend:
          build:
            context: .
            dockerfile: Dockerfile
          ports:
            - 8080:8080
          command: bash -c "
              ./wait-for-postgres.sh db
              && python manage.py migrate
              && gunicorn DRF.wsgi -b 0.0.0.0:8080
                "
          volumes:
            - .:/code
          depends_on:
            - db
          links:
            - db

      nginx:
        build: ./nginx
        privileged: true
        ports:
          - 8000:80
        depends_on:
          - backend

      frontend:
        build: ./frontend
        privileged: true
        ports:
          - 80:80
        depends_on:
          - backend
        volumes:
          - ./logs:/var/log/nginx




